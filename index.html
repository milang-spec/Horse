<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pferdehof ‚Äì Putzen & Reiten (Hotspots)</title>
<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(#eef7ff,#f7fff3);color:#04291f}
  .wrap{max-width:1200px;margin:0 auto;padding:12px}
  header{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{margin:0;font-size:clamp(20px,3.6vw,30px);color:#065f46}
  button{cursor:pointer;border:1px solid #0ea5e9;background:#0ea5e9;color:#fff;border-radius:12px;padding:10px 14px;font-weight:600}
  button.secondary{background:#fff;color:#111;border-color:#e5e7eb}
  button:disabled{opacity:.6}
  .panel{background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:14px}
  .hint{font-size:13px;color:#475569}

  /* Startscreen */
  #startScreen{margin-top:10px}
  .pill{border:1px solid #e5e7eb;background:#fff;border-radius:999px;padding:8px 12px;margin:4px;display:inline-block}
  .pill.active{background:#ecfeff;border-color:#7dd3fc}

  /* Spielbereich */
  #game{display:none;margin-top:10px}
  .stage{display:grid;grid-template-columns:1fr 320px;gap:14px}
  .stall{position:relative;border:6px solid #000;border-radius:16px;background:#f6f3ee;min-height:560px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .rightPanel{border:2px solid #000;border-radius:14px;padding:12px}
  .badge{position:absolute;top:8px;left:8px;background:#fff;border:2px solid #000;border-radius:10px;padding:6px 10px;font-weight:700}
  .status{font-weight:700;margin:8px 0}
  .progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;border:2px solid #000}
  .bar{height:100%;width:0;background:linear-gradient(90deg,#10b981,#22c55e)}

  /* Hotspots */
  .spot{cursor:pointer;fill:rgba(255,255,255,0);stroke-width:0}
  .spot.active{animation:pulse 1.1s ease-in-out infinite alternate}
  @keyframes pulse { from{filter:drop-shadow(0 0 0 rgba(34,197,94,.9))} to{filter:drop-shadow(0 0 8px rgba(34,197,94,.9))} }
  .showOutlines .spot{stroke:#111;stroke-width:2;fill:rgba(255,255,255,.08)} /* Hilfsanzeige */
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üê¥ Pferdehof ‚Äì Putzen & Reiten</h1>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="btnRestart" class="secondary">Neues Spiel</button>
      <button id="btnBack" class="secondary">Zur√ºck</button>
      <button id="btnToggleSpots" class="secondary">Hotspots anzeigen</button>
      <button id="btnMute" class="secondary">üîä Ton an/aus</button>
    </div>
  </header>

  <!-- Start -->
  <section id="startScreen" class="panel">
    <h2 style="margin:0 0 8px">Willkommen am Reiterhof!</h2>
    <p class="hint">W√§hle ein Pferd und einen Namen. Die Fee erkl√§rt die Regeln.</p>
    <div style="display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))">
      <div>
        <h3 style="margin:6px 0">Pferd w√§hlen</h3>
        <div id="horseChoices"></div>
      </div>
      <div>
        <h3 style="margin:6px 0">Namen w√§hlen (antippen = vorlesen)</h3>
        <div id="nameChoices"></div>
      </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="btnExplain" class="secondary">‚ú® Fee erkl√§rt</button>
      <button id="btnStart">Spiel starten</button>
    </div>
  </section>

  <!-- Spiel -->
  <section id="game" class="panel">
    <div class="status" id="status">Los geht‚Äôs!</div>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <div class="stage">
      <div class="stall" id="stall">
        <div class="badge" id="badgeName">Pferd</div>

        <!-- Gro√ües realistischeres Pferd (SVG) mit Hotspots -->
        <div id="horseWrap" aria-label="Pferd">
          <svg id="horseSvg" viewBox="0 0 1000 700" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <rect x="0" y="0" width="1000" height="700" fill="#f5efe6"/>
            <g id="horseGroup">
              <!-- Schweif -->
              <path d="M240,410
                       c-80,40 -110,120 -40,190
                       c25,28 60,35 85,20
                       c-35,-20 -40,-50 -18,-78
                       c-24,-20 -22,-54 -2,-77
                       c-8,-10 -12,-22 -25,-55z"
                    fill="#3b2f2f" stroke="#000" stroke-width="6"/>

              <!-- K√∂rper -->
              <path class="body" d="M300,470
                       c0,-120 120,-210 280,-210
                       c140,0 240,70 260,170
                       c10,55 -20,120 -140,140
                       l-310,0
                       c-60,-10 -90,-45 -90,-100z"
                    fill="#7b4e2d" stroke="#000" stroke-width="6"/>

              <!-- Hals -->
              <path class="body" d="M700,330
                       c-10,-40 15,-65 45,-85
                       c30,-20 65,-30 90,-18
                       c-5,35 -25,55 -45,70
                       c-22,16 -42,28 -50,58
                       l-40,-25z"
                    fill="#7b4e2d" stroke="#000" stroke-width="6"/>

              <!-- Kopf -->
              <path class="body" d="M865,210
                       c45,10 75,35 85,65
                       c8,24 0,45 -18,58
                       c-24,18 -62,18 -102,8
                       c-15,-4 -30,-12 -32,-28
                       c-3,-22 8,-40 30,-60
                       c12,-10 26,-24 37,-43z"
                    fill="#7b4e2d" stroke="#000" stroke-width="6"/>

              <!-- Ohren -->
              <path d="M858,200 l-25,-35 l40,5 z" fill="#7b4e2d" stroke="#000" stroke-width="6"/>
              <path d="M880,205 l-15,-38 l38,10 z" fill="#7b4e2d" stroke="#000" stroke-width="6"/>

              <!-- Auge & N√ºstern -->
              <circle cx="900" cy="260" r="8" fill="#111"/>
              <circle cx="915" cy="300" r="6" fill="#111"/>
              <circle cx="895" cy="305" r="5" fill="#111"/>

              <!-- M√§hne -->
              <path d="M760,215
                       c-25,35 -55,60 -70,110
                       c-5,18 -8,36 5,48
                       c-35,-25 -55,-55 -60,-88
                       c-3,-22 10,-40 26,-54
                       c18,-16 45,-26 99,-16z"
                    fill="#2e2a2a" stroke="#000" stroke-width="6"/>

              <!-- Beine -->
              <path class="body" d="M530,600 l0,-150 l40,0 l0,150 z" fill="#7b4e2d" stroke="#000" stroke-width="6"/>
              <path class="body" d="M590,600 l0,-150 l40,0 l0,150 z" fill="#7b4e2d" stroke="#000" stroke-width="6"/>
              <path class="body" d="M360,600 l0,-150 l40,0 l0,150 z" fill="#7b4e2d" stroke="#000" stroke-width="6"/>
              <path class="body" d="M420,600 l0,-150 l40,0 l0,150 z" fill="#7b4e2d" stroke="#000" stroke-width="6"/>

              <!-- Hufe -->
              <rect x="360" y="600" width="40" height="22" fill="#333"/>
              <rect x="420" y="600" width="40" height="22" fill="#333"/>
              <rect x="530" y="600" width="40" height="22" fill="#333"/>
              <rect x="590" y="600" width="40" height="22" fill="#333"/>

              <!-- Sattel & Trense (einblendbar) -->
              <g id="saddleMark" style="opacity:0;transform:translateY(-12px);transition:all .6s ease">
                <rect x="470" y="390" width="220" height="90" rx="18" fill="#8b5cf6" stroke="#000" stroke-width="6"/>
                <path d="M905,285 c45,-15 70,12 70,12" stroke="#000" stroke-width="6" fill="none"/>
                <circle cx="970" cy="295" r="8" fill="#000"/>
              </g>

              <!-- HOTSPOTS -->
              <!-- Hufe -->
              <g data-part="hoof">
                <rect class="spot" x="360" y="598" width="40" height="30" rx="6"/>
                <rect class="spot" x="420" y="598" width="40" height="30" rx="6"/>
                <rect class="spot" x="530" y="598" width="40" height="30" rx="6"/>
                <rect class="spot" x="590" y="598" width="40" height="30" rx="6"/>
              </g>
              <!-- K√∂rper (Striegel/Kard√§tsche) -->
              <path class="spot" data-part="body"
                    d="M300,470
                       c0,-120 120,-210 280,-210
                       c140,0 240,70 260,170
                       c10,55 -20,120 -140,140
                       l-310,0
                       c-60,-10 -90,-45 -90,-100z"/>
              <!-- M√§hne -->
              <path class="spot" data-part="mane"
                    d="M760,215
                       c-25,35 -55,60 -70,110
                       c-5,18 -8,36 5,48"
                    stroke-width="50" stroke="rgba(255,255,255,0)"/>
              <!-- Schweif -->
              <path class="spot" data-part="tail"
                    d="M240,410
                       c-80,40 -110,120 -40,190"
                    stroke-width="60" stroke="rgba(255,255,255,0)"/>
              <!-- Beine (oberhalb der Hufe) -->
              <g data-part="legs">
                <rect class="spot" x="360" y="450" width="40" height="150"/>
                <rect class="spot" x="420" y="450" width="40" height="150"/>
                <rect class="spot" x="530" y="450" width="40" height="150"/>
                <rect class="spot" x="590" y="450" width="40" height="150"/>
              </g>
            </g>
          </svg>
        </div>
      </div>

      <div class="rightPanel">
        <div style="font-weight:700;margin-bottom:8px">Aufgabe</div>
        <div id="taskText">Tippe auf die <b>Hufe</b>, um sie auszukratzen.</div>
        <div style="margin-top:12px"><button id="btnSaddle" class="secondary" disabled>ü™ù Sattel & Trense aufsetzen</button></div>
        <div style="height:12px"></div>
        <div class="hint">Tipp: ‚ÄûHotspots anzeigen‚Äú hilft beim Zielen. Alles wird laut benannt.</div>
      </div>
    </div>
  </section>
</div>

<!-- Audio-Platzhalter (eigene MP3/WAV-URLs eintragen, sonst still) -->
<audio id="sfx_hoof"  src="" preload="none"></audio>
<audio id="sfx_brush" src="" preload="none"></audio>
<audio id="sfx_comb"  src="" preload="none"></audio>
<audio id="sfx_wipe"  src="" preload="none"></audio>

<script>
/* ======= Stimmen (deutsch) ======= */
let muted=false, cachedVoice=null;
function pickGermanVoice(){
  if(cachedVoice) return cachedVoice;
  const voices = speechSynthesis.getVoices?.()||[];
  const prefer=["Google Deutsch","Google German","Microsoft Katja","Microsoft Hedda","de-DE"];
  for(const p of prefer){
    const v=voices.find(v=>(v.name||"").includes(p)||(v.lang||"").toLowerCase()==="de-de");
    if(v){cachedVoice=v; return v;}
  }
  return null;
}
function speak(t, rate=1){
  if(!t||muted||!("speechSynthesis" in window)) return;
  const u=new SpeechSynthesisUtterance(t);
  const v=pickGermanVoice(); if(v) u.voice=v;
  u.lang=v?.lang||"de-DE"; u.rate=rate; u.pitch=1; u.volume=1;
  try{speechSynthesis.cancel();}catch{}
  speechSynthesis.speak(u);
}
if("speechSynthesis" in window && window.speechSynthesis.onvoiceschanged!==undefined){
  window.speechSynthesis.onvoiceschanged=()=>{cachedVoice=null;pickGermanVoice();};
}

/* ======= Auswahl ======= */
const HORSES=[
  {id:"braun",label:"Braunes Pferd",fill:"#7b4e2d"},
  {id:"rapp",label:"Schwarzes Pferd",fill:"#2b2b2b"},
  {id:"schimmel",label:"Wei√ües Pferd",fill:"#eaeaea"}
];
const NAMES=["Bella","Sternchen","Luna","Fanny","Molly","Amira","Nala","Maja"];
let chosenHorse=HORSES[0], chosenName=NAMES[0];

const elStart=document.getElementById("startScreen");
const elGame=document.getElementById("game");
const elHorseChoices=document.getElementById("horseChoices");
const elNameChoices=document.getElementById("nameChoices");
function renderChoices(){
  elHorseChoices.innerHTML="";
  HORSES.forEach(h=>{
    const b=document.createElement("button");
    b.className="pill"+(h.id===chosenHorse.id?" active":"");
    b.textContent=h.label;
    b.onclick=()=>{chosenHorse=h; renderChoices(); speak(h.label)};
    elHorseChoices.appendChild(b);
  });
  elNameChoices.innerHTML="";
  NAMES.forEach(n=>{
    const b=document.createElement("button");
    b.className="pill"+(n===chosenName?" active":"");
    b.textContent=n;
    b.onclick=()=>{chosenName=n; renderChoices(); speak(n)};
    elNameChoices.appendChild(b);
  });
}
renderChoices();

/* ======= Spielstatus ======= */
const STEPS=[
  {id:"hoof",   label:"Hufe auskratzen",            parts:["hoof"],           sfx:"sfx_hoof"},
  {id:"strgl",  label:"K√∂rper striegeln",           parts:["body"],           sfx:"sfx_brush"},
  {id:"mane",   label:"M√§hne & Schweif k√§mmen",     parts:["mane","tail"],    sfx:"sfx_comb"},
  {id:"legs",   label:"Beine b√ºrsten",              parts:["legs"],           sfx:"sfx_wipe"},
  {id:"card",   label:"Kard√§tsche (K√∂rper fein)",   parts:["body"],           sfx:"sfx_brush"}
];
let stepIdx=0;

const elStatus=document.getElementById("status"),
      elBar=document.getElementById("bar"),
      elBadge=document.getElementById("badgeName"),
      elSaddle=document.getElementById("btnSaddle"),
      elHorseSvg=document.getElementById("horseSvg"),
      elHorseGroup=document.getElementById("horseGroup");

/* ======= UI / Progress ======= */
function updateProgressUI(){
  const pct=Math.round((stepIdx/STEPS.length)*100);
  elBar.style.width=pct+"%";
  elStatus.textContent = stepIdx<STEPS.length
    ? `Als N√§chstes: ${STEPS[stepIdx].label}`
    : "Alles sauber! Jetzt Sattel & Trense.";

  // aktive Hotspots highlighten
  elHorseSvg.querySelectorAll(".spot").forEach(s=>s.classList.remove("active"));
  const active=STEPS[stepIdx]?.parts||[];
  active.forEach(p=>{
    elHorseSvg.querySelectorAll(`[data-part="${p}"] .spot,[data-part="${p}"],.spot[data-part="${p}"]`)
      .forEach(n=>n.classList.add("active"));
  });
}

function setHorseColor(){
  document.querySelectorAll('#horseSvg .body').forEach(e=>{
    e.setAttribute('fill', chosenHorse.fill);
  });
}

/* ======= Hotspot-Handling ======= */
function partName(p){ return {hoof:"Hufe", body:"K√∂rper", mane:"M√§hne", tail:"Schweif", legs:"Beine"}[p]||""; }

function handleSpotClick(part){
  const needed = STEPS[stepIdx].parts;
  const ok = needed.includes(part);
  speak(partName(part));
  if(!ok){ speak("Erst " + STEPS[stepIdx].label + ".", .95); pulse(); return; }

  // Aktion ausf√ºhren
  playSfx(STEPS[stepIdx].sfx);
  animateHorse(()=>{
    stopSfx(STEPS[stepIdx].sfx);
    stepIdx++;
    if(stepIdx>=STEPS.length){
      elSaddle.disabled=false;
      speak("Super! Jetzt Sattel und Trense aufsetzen.");
    }else{
      speak("Sehr gut! Weiter geht's.");
    }
    updateProgressUI();
  });
}

function animateHorse(done){
  const g=elHorseGroup; if(!g){done?.();return;}
  g.style.transition="transform .16s ease"; let i=0;
  const t=setInterval(()=>{ i++; g.style.transform=(i%2)?"translateY(-4px)":"translateY(0)";
    if(i>7){ clearInterval(t); g.style.transform=""; done?.(); }},110);
}
function pulse(){ elStatus.style.transition="transform .12s ease"; elStatus.style.transform="scale(1.02)"; setTimeout(()=>elStatus.style.transform="",120); }

/* ======= Audio ======= */
function playSfx(id){ if(muted) return; const a=document.getElementById(id); try{a.currentTime=0;a.play();}catch{} }
function stopSfx(id){ const a=document.getElementById(id); try{a.pause();}catch{} }

/* ======= Buttons ======= */
document.getElementById("btnExplain").onclick=()=>speak("Hallo! Ich bin deine Reiterhof-Fee. Du putzt das Pferd mit Tipp auf die richtigen Stellen: Zuerst die Hufe, dann den K√∂rper striegeln, danach M√§hne und Schweif k√§mmen, die Beine b√ºrsten und zum Schluss mit der Kard√§tsche √ºber den K√∂rper. Wenn alles sauber ist, setzen wir Sattel und Trense auf.");
document.getElementById("btnStart").onclick=()=>{ startGame(); };
document.getElementById("btnBack").onclick=()=>{ elGame.style.display="none"; elStart.style.display="block"; };
document.getElementById("btnRestart").onclick=()=>{ stepIdx=0; elSaddle.disabled=true; updateProgressUI(); speak("Neue Runde! Wir starten mit den Hufen."); };
document.getElementById("btnToggleSpots").onclick=()=>{ document.getElementById("stall").classList.toggle("showOutlines"); };
document.getElementById("btnMute").onclick=()=>{ muted=!muted; if(!muted) speak("Ton eingeschaltet."); };
document.getElementById("btnSaddle").onclick=()=>{ if(stepIdx<STEPS.length) return; const s=document.getElementById("saddleMark"); s.style.opacity=1; s.style.transform="translateY(0)"; speak("Sattel und Trense sind drauf. Bereit zum Reiten!"); };

/* ======= Start Game ======= */
function startGame(){
  elStart.style.display="none"; elGame.style.display="block";
  document.getElementById("badgeName").textContent = chosenName;
  setHorseColor();
  stepIdx=0; elSaddle.disabled=true; updateProgressUI();
  speak(`Das ist ${chosenName}. Tippe auf die Hufe.`);
}

/* ======= Hotspot-Klicks ======= */
elHorseSvg.addEventListener("click", (e)=>{
  const node=e.target;
  if(node.classList.contains("spot")){
    const part=node.getAttribute("data-part") || node.parentElement?.getAttribute("data-part");
    if(part) handleSpotClick(part);
  }
});

/* ======= Init ======= */
(function init(){ /* Auswahl ist gerendert */ })();
</script>
</body>
</html>
